{"version":3,"sources":["animationTest.js"],"names":["cc","Class","extends","Component","properties","anim","default","type","Animation","animState","AnimationState","visible","start","onLoad","init","frameTime","animationMotion","animationOrientation","heroCodes","callBack","clipIndex","functionName","params","self","heroAnims","cook","then","data","log","catch","error","createClipEvent","frame","func","createAnimation","code","motion","orientation","atlasPath","aniState","loader","loadRes","SpriteAtlas","err","atlas","spriteFrames","getSpriteFrames","clip","AnimationClip","createWithSpriteFrames","name","cbFrameTime","length","node","addComponent","addClip","play","wrapMode","speed","loadSpriteAtlas","promise","Promise","resolve","reject","console","p","setTimeout"],"mappings":"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","file":"animationTest.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\js\\test","sourcesContent":["// var clipEvent = require(\"animationClipEvent\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        anim: {\r\n            default: null,\r\n            type: cc.Animation\r\n        },\r\n        animState: {\r\n            default: null,\r\n            type: cc.AnimationState,\r\n            visible: false\r\n        }\r\n    },\r\n    start:function(){\r\n\r\n    },\r\n    onLoad: function () {\r\n        this.init();\r\n    },\r\n    init:function(){\r\n        this.frameTime = 10;\r\n        /**\r\n         *  动画动作\r\n            ack       = 攻击（进行时）\r\n            ackStance = 攻击姿势\r\n            art       = 技能\r\n            die       = 死亡\r\n            move      = 移动\r\n            stand     = 站立 \r\n         */\r\n        this.animationMotion = ['ack','ackStance','art','die','move','stand'];\r\n        /**\r\n         * 动画方向\r\n            left      = 左\r\n            downleft  = 左下\r\n            down      = 下\r\n            downright = 右下\r\n            right     = 右\r\n            upright   = 右上\r\n            up        = 上\r\n            upleft    = 左上\r\n         */\r\n        this.animationOrientation =['left','downleft','down','downright','right','upright','up','upleft'];\r\n        /**\r\n         * 英雄列表\r\n         */\r\n        this.heroCodes = ['0001'];\r\n\r\n        /**\r\n         * 回调方法参数对象\r\n         * first：第一帧\r\n         * 数字：某一帧\r\n         * last：最后一帧\r\n         */\r\n        this.callBack = {\r\n            'ack':{clipIndex:'last',functionName:'callBack',params:[]},\r\n            'ackStance':{clipIndex:'',functionName:'',params:[]},\r\n            'art':{clipIndex:'',functionName:'',params:[]},\r\n            'die':{clipIndex:'',functionName:'',params:[]},\r\n            'move':{clipIndex:'',functionName:'',params:[]},\r\n            'stand':{clipIndex:'',functionName:'',params:[]}\r\n        };\r\n        \r\n        var self = this\r\n        var heroAnims = {}; \r\n        // for(let code of this.heroCodes){\r\n        //     for(let motion of this.animationMotion){\r\n        //         let motionList = [];\r\n        //         for(let orientation of this.animationOrientation){\r\n        //             let anim = this.createAnimation(code,motion,orientation);\r\n        //             if(anim){\r\n        //                 motionList.push(anim);\r\n        //             }\r\n        //         }\r\n        //         heroAnims[motion] = motionList;\r\n        //     }\r\n        // }\r\n        // let anim = this.createAnimation('0001','ack','downright');\r\n        // cc.log(anim);\r\n        // cc.log(heroAnims);\r\n\r\n        // this.cook().then(function(data){\r\n        //     cc.log(data);\r\n        // }).catch(function(error){\r\n        //     cc.log(error);\r\n        // })\r\n        // this.loadSpriteAtlas('0001/ack/downright');\r\n        this.cook().then(function(data){\r\n             cc.log(data);\r\n        }).catch((error) => {\r\n            cc.log(error);\r\n        });\r\n        cc.log(\"方法结束\");\r\n    },\r\n    createClipEvent : function(frame,func,params){\r\n        return {frame,func,params};\r\n    },\r\n    callBack :function(){\r\n        cc.log('callBack');\r\n    },\r\n    /**\r\n     * code：英雄编号\r\n     * motion：动作\r\n     * orientation：方向\r\n     */\r\n    createAnimation:function(code, motion, orientation){\r\n        let atlasPath = `${code}/${motion}/${orientation}`;\r\n        //var atlasPath = `0001/ack/downright`;\r\n        var self = this;\r\n        var anim = null;\r\n        var aniState = null;\r\n        cc.loader.loadRes(atlasPath, cc.SpriteAtlas, function (err, atlas) {\r\n            //cc.log(atlas);\r\n            if(err){\r\n                cc.log(err);\r\n                return null;\r\n            }\r\n            let spriteFrames = atlas.getSpriteFrames();\r\n            let clip = cc.AnimationClip.createWithSpriteFrames(spriteFrames, self.frameTime);\r\n            clip.name = orientation\r\n            let cbFrameTime = self.frameTime * spriteFrames.length;\r\n            //let clipEvent = self.createClipEvent(cbFrameTime,'callBack',[]);\r\n            //clip.events.push(clipEvent);\r\n            // cc.log(clipEvent);\r\n            // cc.log(clip.events);\r\n            // cc.log(clip);\r\n            anim = self.node.addComponent(cc.Animation);\r\n            anim.addClip(clip);\r\n            aniState = anim.play(orientation);\r\n            aniState.wrapMode = 2;// 播放模式\r\n            aniState.speed = 1;// 播放速度控制\r\n            //aniState = anim.play('downright');\r\n            cc.log(anim);\r\n            return anim;\r\n        });\r\n        return null;\r\n    },\r\n    loadSpriteAtlas:function(atlasPath){\r\n        cc.log(\"开始请求图片集\");\r\n        var promise = new Promise((resolve, reject) => {\r\n            cc.loader.loadRes(atlasPath, cc.SpriteAtlas, function (err, atlas) {\r\n                //cc.log(atlas);\r\n                if(err){\r\n                    reject(err);\r\n                }\r\n                cc.log(\"请求成功\"+atlas.getSpriteFrames());\r\n                resolve(atlas.getSpriteFrames());\r\n            }); \r\n        });\r\n        promise.then(function(spriteFrames){\r\n            return spriteFrames;\r\n        }).catch(function(err){\r\n            cc.log(err);\r\n        });\r\n        \r\n    },\r\n    cook :function (){\r\n        console.log('开始做饭。');\r\n        var p = new Promise(function(resolve, reject){\r\n            setTimeout(function(){\r\n                console.log('做饭完毕！');\r\n                if(false){\r\n                    resolve('鸡蛋炒饭');\r\n                }else{\r\n                    reject(\"厨房爆炸!!!\");\r\n                }\r\n            }, 10000);\r\n        });\r\n        return p;\r\n    }\r\n});\r\n "]}